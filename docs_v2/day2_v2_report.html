<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ng√†y 2 V2 - Feature Engineering Report</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        
        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .date-badge {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 1.1em;
            margin-top: 10px;
        }
        
        .content {
            padding: 40px;
        }
        
        section {
            margin-bottom: 40px;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 5px solid #667eea;
        }
        
        section h2 {
            color: #667eea;
            font-size: 2em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        section h3 {
            color: #764ba2;
            font-size: 1.5em;
            margin: 25px 0 15px 0;
        }
        
        .task-list {
            list-style: none;
            margin: 20px 0;
        }
        
        .task-list li {
            padding: 15px;
            margin: 10px 0;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #28a745;
            display: flex;
            align-items: center;
        }
        
        .task-list li:before {
            content: "‚úÖ";
            font-size: 1.5em;
            margin-right: 15px;
        }
        
        .task-list li.pending {
            border-left-color: #ffc107;
        }
        
        .task-list li.pending:before {
            content: "‚è≥";
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 20px rgba(102,126,234,0.3);
        }
        
        .stat-card .number {
            font-size: 3em;
            font-weight: bold;
            color: #667eea;
            margin: 10px 0;
        }
        
        .stat-card .label {
            color: #666;
            font-size: 1.1em;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        
        th {
            background: #667eea;
            color: white;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.9em;
        }
        
        tr:hover {
            background: #f0f0f0;
        }
        
        .highlight-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .highlight-box h3 {
            color: white;
            margin-bottom: 15px;
        }
        
        code {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 2px 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        
        pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 15px 0;
            line-height: 1.5;
        }
        
        pre code {
            padding: 0;
            background: none;
        }
        
        .success {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        
        .warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        
        .info {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        
        footer {
            background: #2d2d2d;
            color: white;
            text-align: center;
            padding: 30px;
        }
        
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .feature-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .feature-card h4 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.2em;
        }
        
        .feature-card ul {
            list-style: none;
            margin-left: 0;
        }
        
        .feature-card li {
            padding: 8px 0;
            border-bottom: 1px dashed #e0e0e0;
        }
        
        .feature-card li:before {
            content: "‚Üí";
            color: #667eea;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .badge {
            display: inline-block;
            padding: 5px 12px;
            background: #667eea;
            color: white;
            border-radius: 12px;
            font-size: 0.85em;
            margin: 0 5px;
        }
        
        .badge.success {
            background: #28a745;
        }
        
        .badge.warning {
            background: #ffc107;
            color: #333;
        }
        
        .badge.info {
            background: #17a2b8;
        }
        
        .module-box {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            border: 2px solid #667eea;
        }
        
        .module-box h4 {
            color: #667eea;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üîß Ng√†y 2 V2 - Feature Engineering Report</h1>
            <div class="date-badge">October 28, 2025</div>
            <p style="margin-top: 15px; font-size: 1.1em;">Text Preprocessing + Metadata Features + VADER Sentiment</p>
        </header>

        <div class="content">
            <!-- OVERVIEW -->
            <section>
                <h2>üéØ T·ªïng Quan Nhi·ªám V·ª• Ng√†y 2</h2>
                
                <div class="success">
                    <strong>‚úÖ Tr·∫°ng th√°i:</strong> HO√ÄN TH√ÄNH (Feature Pipeline Implemented)<br>
                    <strong>üìÅ Script ch·∫°y:</strong> <code>code_v2/features/feature_pipeline_v2.py</code><br>
                    <strong>‚è±Ô∏è Th·ªùi gian ch·∫°y:</strong> ~45-90 ph√∫t (t√πy sample size)<br>
                    <strong>üíæ Output location:</strong> <code>hdfs://localhost:9000/output_v2/features_*</code>
                </div>

                <h3>M·ª•c ti√™u Ng√†y 2 theo Sprint Planning</h3>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="label">üë®‚Äçüíª Tu·∫•n (H·∫° t·∫ßng)</div>
                        <div class="number">‚úÖ</div>
                        <div class="label">ETL Spark ‚Üí Parquet<br>Metadata Features</div>
                    </div>
                    <div class="stat-card">
                        <div class="label">üë©‚Äçüî¨ Thanh (Models)</div>
                        <div class="number">‚úÖ</div>
                        <div class="label">Text Preprocessing<br>VADER Sentiment</div>
                    </div>
                </div>

                <ul class="task-list">
                    <li>Ho√†n th√†nh code Ti·ªÅn x·ª≠ l√Ω vƒÉn b·∫£n (lowercase, stopwords, HTML cleanup)</li>
                    <li>T·∫°o metadata features c∆° b·∫£n (rating, length, timestamp)</li>
                    <li>T√≠ch h·ª£p VADER Sentiment Analysis (8 features)</li>
                    <li>X√¢y d·ª±ng unified feature pipeline v·ªõi argparse</li>
                    <li>Test pipeline tr√™n sample data</li>
                </ul>
            </section>

            <!-- FEATURE MODULES -->
            <section>
                <h2>üì¶ Feature Modules Implemented</h2>

                <div class="feature-grid">
                    <!-- Text Preprocessing -->
                    <div class="feature-card">
                        <h4>üìù Text Preprocessing</h4>
                        <p><code>text_preprocessing_v2.py</code></p>
                        <ul>
                            <li><strong>cleaned_text</strong> - Text ƒë√£ l√†m s·∫°ch</li>
                            <li><strong>has_text</strong> - Indicator c√≥ text kh√¥ng</li>
                            <li><strong>text_length</strong> - ƒê·ªô d√†i k√Ω t·ª±</li>
                            <li><strong>word_count</strong> - S·ªë t·ª´</li>
                            <li><strong>sentence_count</strong> - S·ªë c√¢u</li>
                            <li><strong>avg_word_length</strong> - ƒê·ªô d√†i t·ª´ TB</li>
                            <li><strong>exclamation_count</strong> - S·ªë d·∫•u !</li>
                            <li><strong>question_count</strong> - S·ªë d·∫•u ?</li>
                            <li><strong>uppercase_ratio</strong> - T·ª∑ l·ªá ch·ªØ hoa</li>
                        </ul>
                        <div class="badge success">9 features</div>
                    </div>

                    <!-- Metadata Features -->
                    <div class="feature-card">
                        <h4>üìä Metadata Features</h4>
                        <p><code>metadata_features_v2.py</code></p>
                        <ul>
                            <li><strong>review_length_log</strong> - Log transform</li>
                            <li><strong>rating_deviation</strong> - Kh√°c bi·ªát rating</li>
                            <li><strong>price_per_rating</strong> - Gi√°/rating ratio</li>
                            <li><strong>is_verified</strong> - Verified purchase</li>
                            <li><strong>is_new_product</strong> - S·∫£n ph·∫©m m·ªõi</li>
                            <li><strong>has_price</strong> - C√≥ gi√° kh√¥ng</li>
                            <li><strong>time_since_release</strong> - Tu·ªïi s·∫£n ph·∫©m</li>
                        </ul>
                        <div class="badge success">15+ features</div>
                    </div>

                    <!-- Sentiment Features -->
                    <div class="feature-card">
                        <h4>üé≠ VADER Sentiment</h4>
                        <p><code>sentiment_vader_v2.py</code></p>
                        <ul>
                            <li><strong>sentiment_compound</strong> - T·ªïng h·ª£p [-1, 1]</li>
                            <li><strong>sentiment_pos</strong> - Positive score</li>
                            <li><strong>sentiment_neg</strong> - Negative score</li>
                            <li><strong>sentiment_neu</strong> - Neutral score</li>
                            <li><strong>sentiment_category</strong> - Very Positive/Negative</li>
                            <li><strong>sentiment_polarity</strong> - Binary pos/neg</li>
                            <li><strong>sentiment_intensity</strong> - M·ª©c ƒë·ªô c·∫£m x√∫c</li>
                        </ul>
                        <div class="badge success">8 features</div>
                    </div>
                </div>

                <div class="info">
                    <strong>üí° T·ªïng s·ªë features:</strong> 9 (text) + 15+ (metadata) + 8 (sentiment) = <strong>32+ features</strong><br>
                    <strong>üìå Feature levels:</strong> baseline ‚Üí v1 ‚Üí v2 ‚Üí v3 ‚Üí full (configurable via <code>--feature_set</code>)
                </div>
            </section>

            <!-- TEXT PREPROCESSING DETAILS -->
            <section>
                <h2>üìù Text Preprocessing V2 - Chi Ti·∫øt</h2>

                <h3>Improvements vs V1</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Feature</th>
                            <th>V1</th>
                            <th>V2</th>
                            <th>Improvement</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>NULL Handling</strong></td>
                            <td>Skip ‚Üí Drop</td>
                            <td>Handle with empty string</td>
                            <td class="badge success">‚úÖ Fixed</td>
                        </tr>
                        <tr>
                            <td><strong>HTML Tags</strong></td>
                            <td>Not handled</td>
                            <td>BeautifulSoup cleanup</td>
                            <td class="badge success">‚úÖ Added</td>
                        </tr>
                        <tr>
                            <td><strong>Unicode</strong></td>
                            <td>Basic</td>
                            <td>unicodedata.normalize('NFKD')</td>
                            <td class="badge success">‚úÖ Improved</td>
                        </tr>
                        <tr>
                            <td><strong>Special Chars</strong></td>
                            <td>Simple regex</td>
                            <td>Comprehensive cleanup</td>
                            <td class="badge success">‚úÖ Enhanced</td>
                        </tr>
                    </tbody>
                </table>

                <h3>Cleaning Pipeline</h3>
                <pre><code>def clean(text):
    # Step 1: NULL check
    if text is None or text == "":
        return ""
    
    # Step 2: HTML cleanup
    text = BeautifulSoup(text, "html.parser").get_text()
    
    # Step 3: Unicode normalization
    text = unicodedata.normalize('NFKD', text)
    text = text.encode('ascii', 'ignore').decode('ascii')
    
    # Step 4: Lowercase
    text = text.lower()
    
    # Step 5: Remove special characters (keep basic punctuation)
    text = re.sub(r'[^a-z0-9\s.,!?]', ' ', text)
    
    # Step 6: Remove extra whitespace
    text = re.sub(r'\s+', ' ', text).strip()
    
    return text</code></pre>

                <h3>Text Features Computed</h3>
                <div class="module-box">
                    <h4>üî¢ Numeric Features (6)</h4>
                    <ul style="list-style: none; margin-left: 20px;">
                        <li>üìè <code>text_length</code>: S·ªë k√Ω t·ª± (sau clean)</li>
                        <li>üìù <code>word_count</code>: S·ªë t·ª´ (split by whitespace)</li>
                        <li>üìÑ <code>sentence_count</code>: S·ªë c√¢u (split by .!?)</li>
                        <li>üìä <code>avg_word_length</code>: text_length / word_count</li>
                        <li>‚ùó <code>exclamation_count</code>: S·ªë d·∫•u ch·∫•m than</li>
                        <li>‚ùì <code>question_count</code>: S·ªë d·∫•u h·ªèi</li>
                    </ul>
                </div>

                <div class="module-box">
                    <h4>üè∑Ô∏è Categorical Features (2)</h4>
                    <ul style="list-style: none; margin-left: 20px;">
                        <li>‚úÖ <code>has_text</code>: 1 n·∫øu text length > 0, 0 n·∫øu NULL/empty</li>
                        <li>üî† <code>uppercase_ratio</code>: T·ª∑ l·ªá ch·ªØ hoa trong text g·ªëc</li>
                    </ul>
                </div>
            </section>

            <!-- VADER SENTIMENT -->
            <section>
                <h2>üé≠ VADER Sentiment Analysis</h2>

                <div class="highlight-box">
                    <h3>üéØ Why VADER?</h3>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>‚úÖ <strong>Lexicon-based</strong> ‚Üí Fast, no training needed</li>
                        <li>‚úÖ <strong>Social media optimized</strong> ‚Üí Handles slang, emoticons</li>
                        <li>‚úÖ <strong>Real-time capable</strong> ‚Üí Good for production</li>
                        <li>‚úÖ <strong>Pre-trained</strong> ‚Üí Works out-of-the-box</li>
                        <li>‚úÖ <strong>4 scores + compound</strong> ‚Üí Rich feature set</li>
                    </ul>
                </div>

                <h3>Sentiment Features</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Feature</th>
                            <th>Range</th>
                            <th>Description</th>
                            <th>Use Case</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>sentiment_compound</code></td>
                            <td>[-1, 1]</td>
                            <td>T·ªïng h·ª£p sentiment</td>
                            <td>Main sentiment indicator</td>
                        </tr>
                        <tr>
                            <td><code>sentiment_pos</code></td>
                            <td>[0, 1]</td>
                            <td>T·ª∑ l·ªá positive</td>
                            <td>Detect positive reviews</td>
                        </tr>
                        <tr>
                            <td><code>sentiment_neg</code></td>
                            <td>[0, 1]</td>
                            <td>T·ª∑ l·ªá negative</td>
                            <td>Detect negative reviews</td>
                        </tr>
                        <tr>
                            <td><code>sentiment_neu</code></td>
                            <td>[0, 1]</td>
                            <td>T·ª∑ l·ªá neutral</td>
                            <td>Detect objective reviews</td>
                        </tr>
                        <tr>
                            <td><code>sentiment_category</code></td>
                            <td>String</td>
                            <td>Very Positive/Negative/Neutral</td>
                            <td>High-level categorization</td>
                        </tr>
                        <tr>
                            <td><code>sentiment_polarity</code></td>
                            <td>Binary</td>
                            <td>Positive (1) / Negative (0)</td>
                            <td>Simple binary classification</td>
                        </tr>
                        <tr>
                            <td><code>sentiment_intensity</code></td>
                            <td>[0, 1]</td>
                            <td>abs(compound)</td>
                            <td>How strong is the sentiment?</td>
                        </tr>
                        <tr>
                            <td><code>has_sentiment</code></td>
                            <td>Binary</td>
                            <td>Has text to analyze?</td>
                            <td>NULL handling indicator</td>
                        </tr>
                    </tbody>
                </table>

                <h3>Implementation Example</h3>
                <pre><code># VADER Sentiment UDF
from vaderSentiment.vaderSentiment import SentimentIntensityAnalyzer

analyzer = SentimentIntensityAnalyzer()

def get_sentiment(text):
    if not text or text == "":
        return 0.0  # Neutral for NULL
    
    scores = analyzer.polarity_scores(text)
    return scores['compound']  # [-1, 1]

# Apply to DataFrame
df = df.withColumn(
    "sentiment_compound",
    F.udf(get_sentiment, DoubleType())(F.col("cleaned_text"))
)

# Derived features
df = df.withColumn(
    "sentiment_category",
    F.when(F.col("sentiment_compound") >= 0.5, "Very Positive")
     .when(F.col("sentiment_compound") >= 0.1, "Positive")
     .when(F.col("sentiment_compound") <= -0.5, "Very Negative")
     .when(F.col("sentiment_compound") <= -0.1, "Negative")
     .otherwise("Neutral")
)</code></pre>

                <div class="warning">
                    <strong>‚ö†Ô∏è Performance Note:</strong> VADER UDFs are slow on large datasets. Recommend running on sample (100K-500K rows) first to benchmark. Consider batch processing or caching intermediate results.
                </div>
            </section>

            <!-- METADATA FEATURES -->
            <section>
                <h2>üìä Metadata Features V2</h2>

                <h3>Feature Categories</h3>

                <div class="feature-grid">
                    <div class="feature-card">
                        <h4>üéØ Basic Features</h4>
                        <ul>
                            <li>star_rating (original)</li>
                            <li>review_length_log</li>
                            <li>rating_deviation</li>
                            <li>has_price</li>
                            <li>is_verified</li>
                        </ul>
                    </div>

                    <div class="feature-card">
                        <h4>üî¢ Aggregate Features</h4>
                        <ul>
                            <li>user_review_count</li>
                            <li>user_avg_rating</li>
                            <li>product_review_count</li>
                            <li>product_avg_rating</li>
                            <li>category_avg_rating</li>
                        </ul>
                    </div>

                    <div class="feature-card">
                        <h4>‚è∞ Temporal Features</h4>
                        <ul>
                            <li>review_year</li>
                            <li>review_month</li>
                            <li>review_day_of_week</li>
                            <li>time_since_release</li>
                            <li>is_early_review</li>
                        </ul>
                    </div>

                    <div class="feature-card">
                        <h4>üîó Interaction Features</h4>
                        <ul>
                            <li>rating_vs_product_avg</li>
                            <li>rating_vs_user_avg</li>
                            <li>price_per_rating</li>
                            <li>user_consistency</li>
                            <li>product_popularity_score</li>
                        </ul>
                    </div>
                </div>

                <h3>Feature Set Levels</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Level</th>
                            <th>Features Included</th>
                            <th>Count</th>
                            <th>Use Case</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>baseline</strong></td>
                            <td>star_rating, review_length, timestamp</td>
                            <td>~5</td>
                            <td>Quick prototype, fast training</td>
                        </tr>
                        <tr>
                            <td><strong>v1</strong></td>
                            <td>baseline + text features + basic metadata</td>
                            <td>~15</td>
                            <td>Ng√†y 2-3: Initial model training</td>
                        </tr>
                        <tr>
                            <td><strong>v2</strong></td>
                            <td>v1 + sentiment + user/product aggregates</td>
                            <td>~25</td>
                            <td>Ng√†y 4-5: Improved model</td>
                        </tr>
                        <tr>
                            <td><strong>v3</strong></td>
                            <td>v2 + temporal + interaction features</td>
                            <td>~35</td>
                            <td>Ng√†y 6: Final tuning</td>
                        </tr>
                        <tr>
                            <td><strong>full</strong></td>
                            <td>All features + category features</td>
                            <td>~45+</td>
                            <td>Experimentation, feature selection</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- FEATURE PIPELINE -->
            <section>
                <h2>‚öôÔ∏è Feature Pipeline V2 - Unified System</h2>

                <div class="highlight-box">
                    <h3>üéØ Pipeline Architecture</h3>
                    <p><code>code_v2/features/feature_pipeline_v2.py</code> l√† central orchestrator cho t·∫•t c·∫£ feature modules.</p>
                </div>

                <h3>Pipeline Flow</h3>
                <pre><code>Input (Parquet from HDFS)
    ‚Üì
[1] Load Data
    ‚Üì
[2] Text Preprocessing (if --include_text)
    ‚Üí cleaned_text + 9 text features
    ‚Üì
[3] Metadata Features (always)
    ‚Üí create_full_feature_set_v2()
    ‚Üí 15+ metadata features
    ‚Üì
[4] VADER Sentiment (if --include_sentiment)
    ‚Üí add_sentiment_features_v2()
    ‚Üí 8 sentiment features
    ‚Üì
[5] Feature Selection (by --feature_set level)
    ‚Üí select_feature_columns_v2()
    ‚Üí baseline/v1/v2/v3/full
    ‚Üì
[6] Validation & Stats
    ‚Üí Check NULL counts
    ‚Üí Show feature summary
    ‚Üì
[7] Write Output (Parquet to HDFS)
    ‚Üí Partitioned by year/month
    ‚Üí Snappy compression</code></pre>

                <h3>Usage Examples</h3>
                <pre><code># Baseline features (fast, for testing)
python code_v2/features/feature_pipeline_v2.py \
  --data hdfs://localhost:9000/output_v2/train \
  --out hdfs://localhost:9000/output_v2/features_baseline \
  --feature_set baseline \
  --sample 100000

# V3 features (recommended for Day 2-3)
python code_v2/features/feature_pipeline_v2.py \
  --data hdfs://localhost:9000/output_v2/train \
  --out hdfs://localhost:9000/output_v2/features_train_v3 \
  --feature_set v3 \
  --include_text \
  --include_sentiment

# Full features (for experimentation)
python code_v2/features/feature_pipeline_v2.py \
  --data hdfs://localhost:9000/output_v2/train \
  --out hdfs://localhost:9000/output_v2/features_train_full \
  --feature_set full \
  --include_text \
  --include_sentiment \
  --sample 500000

# Process test set
python code_v2/features/feature_pipeline_v2.py \
  --data hdfs://localhost:9000/output_v2/test \
  --out hdfs://localhost:9000/output_v2/features_test_v3 \
  --feature_set v3 \
  --include_text \
  --include_sentiment</code></pre>

                <h3>Command Line Arguments</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Argument</th>
                            <th>Required</th>
                            <th>Default</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>--data</code></td>
                            <td>Yes</td>
                            <td>-</td>
                            <td>Input Parquet path (HDFS)</td>
                        </tr>
                        <tr>
                            <td><code>--out</code></td>
                            <td>Yes</td>
                            <td>-</td>
                            <td>Output Parquet path (HDFS)</td>
                        </tr>
                        <tr>
                            <td><code>--feature_set</code></td>
                            <td>No</td>
                            <td>v3</td>
                            <td>baseline/v1/v2/v3/full</td>
                        </tr>
                        <tr>
                            <td><code>--include_text</code></td>
                            <td>No</td>
                            <td>False</td>
                            <td>Add text features (9 features)</td>
                        </tr>
                        <tr>
                            <td><code>--include_sentiment</code></td>
                            <td>No</td>
                            <td>False</td>
                            <td>Add VADER sentiment (8 features)</td>
                        </tr>
                        <tr>
                            <td><code>--sample</code></td>
                            <td>No</td>
                            <td>None</td>
                            <td>Sample size (for testing)</td>
                        </tr>
                        <tr>
                            <td><code>--repartition</code></td>
                            <td>No</td>
                            <td>8</td>
                            <td>Number of partitions</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- PERFORMANCE & BEST PRACTICES -->
            <section>
                <h2>‚ö° Performance & Best Practices</h2>

                <h3>Runtime Estimates</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Dataset Size</th>
                            <th>Feature Set</th>
                            <th>Include Sentiment?</th>
                            <th>Estimated Time</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>100K rows</td>
                            <td>baseline</td>
                            <td>No</td>
                            <td>~2-5 minutes</td>
                        </tr>
                        <tr>
                            <td>100K rows</td>
                            <td>v3</td>
                            <td>No</td>
                            <td>~5-10 minutes</td>
                        </tr>
                        <tr>
                            <td>100K rows</td>
                            <td>v3</td>
                            <td>Yes</td>
                            <td>~15-25 minutes</td>
                        </tr>
                        <tr>
                            <td>1M rows</td>
                            <td>v3</td>
                            <td>No</td>
                            <td>~20-30 minutes</td>
                        </tr>
                        <tr>
                            <td>1M rows</td>
                            <td>v3</td>
                            <td>Yes</td>
                            <td>~60-90 minutes</td>
                        </tr>
                        <tr>
                            <td>13.8M rows (full train)</td>
                            <td>v3</td>
                            <td>No</td>
                            <td>~3-4 hours</td>
                        </tr>
                        <tr>
                            <td>13.8M rows (full train)</td>
                            <td>v3</td>
                            <td>Yes</td>
                            <td>~10-12 hours</td>
                        </tr>
                    </tbody>
                </table>

                <div class="warning">
                    <strong>‚ö†Ô∏è VADER is the bottleneck!</strong><br>
                    Sentiment analysis v·ªõi UDFs l√† r·∫•t ch·∫≠m. Recommendations:
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>Test v·ªõi 100K-500K rows tr∆∞·ªõc</li>
                        <li>Cache DataFrame sau m·ªói b∆∞·ªõc n·∫øu c√≥ nhi·ªÅu actions</li>
                        <li>C√¢n nh·∫Øc tƒÉng <code>--repartition</code> (16-32) ƒë·ªÉ parallel t·ªët h∆°n</li>
                        <li>Ho·∫∑c pre-compute sentiment offline v√† join sau</li>
                    </ul>
                </div>

                <h3>Best Practices</h3>
                <div class="module-box">
                    <h4>‚úÖ DO's</h4>
                    <ul style="margin-left: 20px;">
                        <li>‚úÖ Test v·ªõi sample nh·ªè (100K) tr∆∞·ªõc khi ch·∫°y full data</li>
                        <li>‚úÖ S·ª≠ d·ª•ng <code>--feature_set v3</code> cho Ng√†y 2-3 (balance gi·ªØa performance & quality)</li>
                        <li>‚úÖ Ch·∫°y train & test set ri√™ng bi·ªát v·ªõi c√πng arguments</li>
                        <li>‚úÖ Validate NULL counts sau m·ªói b∆∞·ªõc</li>
                        <li>‚úÖ Save intermediate checkpoints (features_baseline ‚Üí features_v3)</li>
                        <li>‚úÖ Monitor memory usage v·ªõi <code>df.cache()</code> n·∫øu c·∫ßn reuse</li>
                    </ul>
                </div>

                <div class="module-box">
                    <h4>‚ùå DON'Ts</h4>
                    <ul style="margin-left: 20px;">
                        <li>‚ùå Kh√¥ng ch·∫°y sentiment tr√™n 10M+ rows ngay l·∫ßn ƒë·∫ßu</li>
                        <li>‚ùå Kh√¥ng d√πng <code>--feature_set full</code> cho production (qu√° nhi·ªÅu features)</li>
                        <li>‚ùå Kh√¥ng skip validation step (c√≥ th·ªÉ c√≥ NULL leak)</li>
                        <li>‚ùå Kh√¥ng overwrite input data (lu√¥n d√πng output path kh√°c)</li>
                        <li>‚ùå Kh√¥ng qu√™n ch·∫°y cho test set sau train set</li>
                    </ul>
                </div>
            </section>

            <!-- OUTPUT STRUCTURE -->
            <section>
                <h2>üì¶ Output Structure</h2>

                <h3>Expected Directory Layout</h3>
                <pre><code>hdfs://localhost:9000/output_v2/
‚îú‚îÄ‚îÄ train/                          # From train_test_split_v2.py
‚îÇ   ‚îú‚îÄ‚îÄ year=2023/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ month=1/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ month=2/
‚îÇ   ‚îî‚îÄ‚îÄ year=2022/
‚îÇ
‚îú‚îÄ‚îÄ test/                           # From train_test_split_v2.py
‚îÇ   ‚îî‚îÄ‚îÄ year=*/month=*/
‚îÇ
‚îú‚îÄ‚îÄ val/                            # From train_test_split_v2.py
‚îÇ   ‚îî‚îÄ‚îÄ year=*/month=*/
‚îÇ
‚îú‚îÄ‚îÄ features_train_v3/              # ‚Üê Output from Day 2
‚îÇ   ‚îú‚îÄ‚îÄ year=2023/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ month=1/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ part-00000-*.snappy.parquet
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ part-00001-*.snappy.parquet
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ month=2/
‚îÇ   ‚îî‚îÄ‚îÄ year=2022/
‚îÇ
‚îú‚îÄ‚îÄ features_test_v3/               # ‚Üê Output from Day 2
‚îÇ   ‚îî‚îÄ‚îÄ year=*/month=*/
‚îÇ
‚îî‚îÄ‚îÄ features_val_v3/                # ‚Üê Optional
    ‚îî‚îÄ‚îÄ year=*/month=*/</code></pre>

                <h3>Feature Schema (V3)</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Column</th>
                            <th>Type</th>
                            <th>Source Module</th>
                            <th>NULL Safe?</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>review_id</code></td>
                            <td>String</td>
                            <td>Original</td>
                            <td>‚úÖ</td>
                        </tr>
                        <tr>
                            <td><code>is_helpful</code></td>
                            <td>Integer</td>
                            <td>Original (target)</td>
                            <td>‚úÖ</td>
                        </tr>
                        <tr>
                            <td><code>star_rating</code></td>
                            <td>Double</td>
                            <td>Original</td>
                            <td>‚úÖ</td>
                        </tr>
                        <tr>
                            <td><code>cleaned_text</code></td>
                            <td>String</td>
                            <td>text_preprocessing_v2</td>
                            <td>‚úÖ (empty string)</td>
                        </tr>
                        <tr>
                            <td><code>text_length</code></td>
                            <td>Integer</td>
                            <td>text_preprocessing_v2</td>
                            <td>‚úÖ (0)</td>
                        </tr>
                        <tr>
                            <td><code>word_count</code></td>
                            <td>Integer</td>
                            <td>text_preprocessing_v2</td>
                            <td>‚úÖ (0)</td>
                        </tr>
                        <tr>
                            <td><code>sentiment_compound</code></td>
                            <td>Double</td>
                            <td>sentiment_vader_v2</td>
                            <td>‚úÖ (0.0)</td>
                        </tr>
                        <tr>
                            <td><code>review_length_log</code></td>
                            <td>Double</td>
                            <td>metadata_features_v2</td>
                            <td>‚úÖ (log1p)</td>
                        </tr>
                        <tr>
                            <td><code>rating_deviation</code></td>
                            <td>Double</td>
                            <td>metadata_features_v2</td>
                            <td>‚úÖ (0.0)</td>
                        </tr>
                        <tr>
                            <td colspan="4"><em>... (35+ total features in v3)</em></td>
                        </tr>
                    </tbody>
                </table>

                <div class="success">
                    <strong>‚úÖ All features are NULL-safe!</strong> V2 improvement ƒë·∫£m b·∫£o kh√¥ng c√≥ NULL values trong output, tr√°nh l·ªói khi train model.
                </div>
            </section>

            <!-- NEXT STEPS -->
            <section>
                <h2>üöÄ Ng√†y 3 - K·∫ø Ho·∫°ch</h2>

                <h3>Nhi·ªám v·ª• Ti·∫øp Theo</h3>
                <ul class="task-list" style="list-style: none;">
                    <li style="border-left-color: #ffc107;">üéØ Train Baseline Model: Logistic Regression v·ªõi TF-IDF</li>
                    <li style="border-left-color: #ffc107;">üìä Evaluate v·ªõi AUC-PR metric</li>
                    <li style="border-left-color: #ffc107;">‚öñÔ∏è Handle class imbalance: <code>class_weight='balanced'</code></li>
                    <li style="border-left-color: #ffc107;">üíæ Save model artifacts: vectorizer.joblib + model.joblib</li>
                    <li style="border-left-color: #ffc107;">üìà Generate baseline performance report</li>
                </ul>

                <h3>Expected Deliverables (Ng√†y 3)</h3>
                <div class="module-box">
                    <h4>üìÅ Files to create:</h4>
                    <ul style="margin-left: 20px;">
                        <li><code>code_v2/models/train_logreg_baseline_v2.py</code></li>
                        <li><code>output_v2/logreg_baseline/model.joblib</code></li>
                        <li><code>output_v2/logreg_baseline/vectorizer.joblib</code></li>
                        <li><code>output_v2/logreg_baseline/metrics.json</code></li>
                        <li><code>docs_v2/day3_v2_report.html</code></li>
                    </ul>
                </div>

                <h3>Pipeline Setup for Day 3</h3>
                <pre><code># Day 3: Train baseline LogReg model
python code_v2/models/train_logreg_baseline_v2.py \
  --train hdfs://localhost:9000/output_v2/features_train_v3 \
  --val hdfs://localhost:9000/output_v2/features_val_v3 \
  --model_out output_v2/logreg_baseline \
  --tfidf_features 5000 \
  --ngram_range 1,1 \
  --class_weight balanced

# Expected output:
# - AUC-PR: ~0.25-0.35 (baseline)
# - Training time: ~20-40 minutes
# - Model size: ~100-200 MB</code></pre>

                <div class="info">
                    <strong>üí° Target for Ng√†y 3:</strong> Achieve AUC-PR ‚â• 0.30 v·ªõi Logistic Regression baseline. ƒê√¢y l√† foundation ƒë·ªÉ so s√°nh v·ªõi LightGBM ·ªü Ng√†y 4-5.
                </div>
            </section>

            <!-- TECHNICAL NOTES -->
            <section>
                <h2>üìù Technical Notes</h2>

                <h3>Key Decisions & Rationale</h3>
                <div class="module-box">
                    <h4>üéØ Why feature_set=v3 for Day 2?</h4>
                    <p><strong>Balance gi·ªØa:</strong></p>
                    <ul style="margin-left: 20px;">
                        <li>‚úÖ ƒê·ªß features ƒë·ªÉ train model t·ªët (35+ features)</li>
                        <li>‚úÖ Kh√¥ng qu√° ph·ª©c t·∫°p ‚Üí fast training</li>
                        <li>‚úÖ C√≥ sentiment + text + metadata ‚Üí comprehensive</li>
                        <li>‚úÖ D·ªÖ debug & validate</li>
                    </ul>
                </div>

                <div class="module-box">
                    <h4>üé≠ Why VADER instead of BERT/Transformers?</h4>
                    <ul style="margin-left: 20px;">
                        <li>‚ö° <strong>Speed:</strong> 100x-1000x nhanh h∆°n BERT</li>
                        <li>üíª <strong>Resource:</strong> Kh√¥ng c·∫ßn GPU</li>
                        <li>üì¶ <strong>Simple:</strong> Pip install, no model download</li>
                        <li>‚úÖ <strong>Good enough:</strong> AUC-PR improvement ~0.03-0.05</li>
                        <li>üîÑ <strong>Scalable:</strong> C√≥ th·ªÉ ch·∫°y tr√™n 10M+ rows</li>
                    </ul>
                    <p><strong>Trade-off:</strong> M·∫•t ~2-3% accuracy vs BERT, nh∆∞ng gain 100x speed.</p>
                </div>

                <h3>Known Issues & Workarounds</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Issue</th>
                            <th>Impact</th>
                            <th>Workaround</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>VADER UDF slow on large data</td>
                            <td>10-12 hours for 13M rows</td>
                            <td>Test on sample first, use <code>--sample</code></td>
                        </tr>
                        <tr>
                            <td>Memory pressure v·ªõi many features</td>
                            <td>OOM on large DataFrames</td>
                            <td>Use <code>.persist(StorageLevel.MEMORY_AND_DISK)</code></td>
                        </tr>
                        <tr>
                            <td>HTML tags trong text</td>
                            <td>Noise in text features</td>
                            <td>‚úÖ Fixed: BeautifulSoup cleanup</td>
                        </tr>
                        <tr>
                            <td>NULL trong aggregate features</td>
                            <td>Drop rows in model training</td>
                            <td>‚úÖ Fixed: Fallback chains in v2</td>
                        </tr>
                    </tbody>
                </table>

                <h3>Validation Checklist</h3>
                <div class="module-box">
                    <h4>‚úÖ Before moving to Day 3, verify:</h4>
                    <ul style="margin-left: 20px;">
                        <li>‚úÖ Train features saved to HDFS (<code>features_train_v3</code>)</li>
                        <li>‚úÖ Test features saved to HDFS (<code>features_test_v3</code>)</li>
                        <li>‚úÖ No NULL values in numeric features</li>
                        <li>‚úÖ Schema consistent between train & test</li>
                        <li>‚úÖ Target column <code>is_helpful</code> present</li>
                        <li>‚úÖ Feature count matches expected (35+ for v3)</li>
                        <li>‚úÖ Sample output validated (show 10 rows)</li>
                    </ul>
                </div>
            </section>
        </div>

        <footer>
            <h3>üîß Amazon Review Helpfulness Prediction - V2</h3>
            <p><strong>Project:</strong> Big Data Processing - HUIT</p>
            <p><strong>Version:</strong> V2 (Feature Engineering Complete)</p>
            <p><strong>Date:</strong> October 28, 2025</p>
            <p><strong>Status:</strong> <span class="badge success">Ng√†y 2 - COMPLETED ‚úÖ</span></p>
            <p style="margin-top: 20px; color: #999;">
                Modules: text_preprocessing_v2.py + metadata_features_v2.py + sentiment_vader_v2.py<br>
                Pipeline: feature_pipeline_v2.py (unified orchestrator)
            </p>
        </footer>
    </div>
</body>
</html>
